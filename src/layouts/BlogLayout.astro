---
import BlogHeader from "../components/BlogHeader.astro";
import Footer from "../components/Footer.astro";
import BlogTagList from "../components/BlogTagList.astro";
import CommentsWidget from "../components/CommentsWidget.astro";
import Configure from "./Configure.astro";
import BlogYearList from "../components/BlogYearList.astro";
import Tag from "../components/Tag.astro";

interface Props {
    content: {
        title: string;
        tags: string[];
        pubDate?: string;
        author: string;
        description: string;
    },
    url? : string;
}

const { content, url } = Astro.props;
const slug = url ? url.substring(6) : "";
let pubDate = content.pubDate;
if (pubDate && pubDate.includes('T')) pubDate = pubDate.slice(0, pubDate.indexOf('T'));
const metadataDisplay = pubDate ? "block" : "none";
---

<html lang="en">
<head>
    <meta charset="utf-8" />
    <link rel="icon" href="/img/favicon-32x32.png">
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>{content.title}</title>
    <link rel="stylesheet" href="/css/navbar.css">
    <link rel="stylesheet" href="/css/theme.css">
    <link rel="stylesheet" href="/css/blog.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
          rel="stylesheet" crossorigin="anonymous" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65">
    <Configure/>
</head>
<body>
<BlogHeader />
<div class="blog-page">
    <div class="blog-content">
        <h1 class="blog-title">{content.title}</h1>
        <p class="blog-description">{content.description}</p>
        <p style=`display: ${metadataDisplay}`>
            <b>{pubDate}, by {content.author}</b>
            {content.tags.map(t => <Tag value={t}/>)}
        </p>
        <slot />
    </div>
    <div class="blog-sidebar">
        <BlogTagList required={content.tags}/>
        <BlogYearList/>
    </div>
</div>

{!!slug && <CommentsWidget url={"blog:" + slug} />}

<Footer views="blog" />
</body>
</html>