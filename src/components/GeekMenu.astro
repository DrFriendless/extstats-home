---
const GEEK_SUB_MENUS = [
    { id: "geekcollection", style: "geek-collection", name: "Collection" },
    { id: "geekowned", style: "geek-owned", name: "Owned Games" },
    { id: "geekfavourites", style: "geek-favourites", name: "Favourites" },
    { id: "geekplays", style: "geek-plays", name: "Plays" },
    { id: "geekmonthly", style: "geek-monthly", name: "By Month" },
    { id: "geekyearly", style: "geek-yearly", name: "By Year" },
    { id: "geekcomparative", style: "geek-comparative", name: "Compare" },
    { id: "geekupdates", style: "geek-updates", name: "Updates" },
];
---
<div id="geekmenu" class="navbar-menu">
    <a id="geeklink" class={"navbar-button geekmenu-button"}>Home</a>
    <div class="navbar-dropdown">
        {
            GEEK_SUB_MENUS.map(item =>
                    <a id={item.id} class={"navbar-button clickable " + item.style}>
                        {item.name}
                    </a>)
        }
    </div>
</div>

<script type="text/javascript">
function showHideGeekButton() {
    let geek = getQueryVariable("geek");
    if (!geek) geek = getCookieData("extstatsid");
    if (geek) {
        document.getElementById("geekmenu").classList.remove("hidden");
        document.getElementById("geeklink").setAttribute("href", "geek.html?geek=" + geek);
        document.getElementById("geekcollection").setAttribute("href", "collection.html?geek=" + geek);
        document.getElementById("geekowned").setAttribute("href", "owned.html?geek=" + geek);
        document.getElementById("geekfavourites").setAttribute("href", "favourites.html?geek=" + geek);
        document.getElementById("geekplays").setAttribute("href", "plays.html?geek=" + geek);
        document.getElementById("geekmonthly").setAttribute("href", "monthly.html?geek=" + geek);
        document.getElementById("geekyearly").setAttribute("href", "yearly.html?geek=" + geek);
        document.getElementById("geekcomparative").setAttribute("href", "multiplays.html?geek=" + geek);
        document.getElementById("geekupdates").setAttribute("href", "updates.html?geek=" + geek);
    } else {
        document.getElementById("geekmenu").classList.add("hidden");
    }
}

function getQueryVariable(variable) {
    const query = window.location.search.substring(1);
    const vars = query.split("&");
    for (let i=0; i<vars.length; i++) {
        const pair = vars[i].split("=");
        if (pair[0] === variable) return pair[1];
    }
    return false;
}

// https://stackoverflow.com/questions/10730362/get-cookie-by-name
function getCookieData(cookieName) {
    const pairs = document.cookie.split("; ");
    let count = pairs.length;
    while (count--) {
        const parts = pairs[count].split("=");
        if (parts[0] === cookieName) return parts[1];
    }
    return false;
}

window.addEventListener("message", showHideGeekButton);

window.addEventListener("load", () => {
  showHideGeekButton();
});
</script>